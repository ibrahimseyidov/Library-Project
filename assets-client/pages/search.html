<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../style/reset.css">
    <link rel="stylesheet" href="../style/search.css">
    <link rel="stylesheet" href="../mobile-style/search.css">
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css" />
    <link rel="stylesheet" href="../style/style.css">
    <link rel="stylesheet" href="../mobile-style/mobile.css">
    <link rel="stylesheet" href="../style/toast.style.css">
    <title>Search Page</title>
</head>

<body>

    <header class="header">

        <div class="header-container">

            <div>
                <a href="../../index.html"><img src="../img/topLogo.svg" alt="logo"></a>
            </div>

            <div class="top-nav">
                <nav>
                    <ul class="home-nav">
                        <li><a href="../../index.html">Home</a></li>
                        <li><a href="./catalog-product.html">Catalog</a></li>
                        <li><a href="./about.html">About Store</a></li>
                        <li><a href="./contact.html">Contact Us</a></li>
                        <li><a href="./search.html" class="active">Search</a></li>
                    </ul>
                </nav>
            </div>

            <div class="join-us">
                <img src="../icons/profile.svg" alt="profile">
                <a id="myBtn">Join Us</a>
            </div>

            <div class="mobile-ham">
                <button class="join-img" id="myBtnMobile"><img src="../icons/profile.svg" alt="profile"
                        class="profile"></button>
                <button onclick="openNav()">
                    <img src="../icons/hamMenu.svg" alt="hamburger-menu">
                </button>
            </div>

        </div>

        <div id="myNav" class="overlay">

            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>

            <div class="overlay-content">
                <a href="../../index.html">Home</a>
                <a href="./catalog-product.html">Catalog</a>
                <a href="./about.html">About Store</a>
                <a href="./contact.html">Contact Us</a>
                <a href="./search.html">Search</a>

            </div>

        </div>

        <div id="myModal" class="modal">

            <div class="modal-content">
                <span class="close"></span>

                <div class="join-modal">
                    <span>Join Us</span>
                    <div class="join-inp">
                        <input type="text" id="fullname" placeholder="Full name">
                        <input type="email" id="email" placeholder="Email">
                    </div>
                    <div class="join-btn">
                        <button id="joinbtn">Join</button>
                    </div>
                </div>
            </div>

        </div>

    </header>


    <div class="contain">
        <main class="searchMain">
            <div class="searchTextButon">
                <div class="searchText">
                    <h1>Search</h1>
                </div>
                <div class="searchInputButton">
                    <input placeholder="Book Name" id="bkNameInp" type="text">
                    <button id="searchBtn">Search</button>
                </div>
            </div>
            <div class="searchAboutBook">
                <!-- <div class="prev">《</div> -->
                <div class="card your-class" id="cardContainer">
                    <!-- <div class="insideCard">
                        <div>
                            <img src="../img/searchBook.svg" alt="">
                        </div>
                        <div class="bookText">
                            <h2>Order Books</h2>
                            <h3>Author</h3>
                            <p>
                                We work without holidays and weekends! Residents of Kiev can receive an order on the day
                                of its registration. Customers from other cities of Ukraine can receive an order within
                                1-5 days, depending on the location of the settlement and the selected delivery method.
                                Orders over UAH 1000 are delivered free of charge *. You can see the available methods,
                                exact terms and cost of delivery during checkout in the order basket, after selecting
                                the delivery city
                            </p>
                        </div>
                    </div> -->
                    <!-- <div style="display: flex; flex-direction: column; align-items:center;">
                        <div style="margin-bottom:30px">
                            <img src="../img/sad.jpg" style="width: 100px; border-radius: 50%">
                        </div>
                        <span style="font-size: 28px; color:rgb(114, 4, 24); font-weight: 700;" >Searched Book Not Found</span>
                    </div>
                </div> -->
                    <!-- <div class="next">》</div> -->

                </div>
        </main>

        <div class="social-bar">
            <section class="five-sec">

                <div class="follow">
                    <h3>Follow us on social media</h3>
                </div>

                <div class="media-icon">
                    <a href="https://www.facebook.com/" target="_blank"><img src="../icons/facebook.svg"
                            alt="facebook"></a>
                    <a href="https://twitter.com/" class="twitter" target="_blank"><img src="../icons/twitter.svg"
                            alt="twitter"></a>
                    <a href="https://www.instagram.com/" target="_blank"><img src="../icons/instagram.svg"
                            alt="instagram"></a>
                </div>

            </section>
        </div>
    </div>

    <footer class="footer-sec">

        <div class="contain">

            <div class="footer-area">

                <div class="bottom-logo">
                    <img src="../img/bottomLogo.svg" alt="logo">
                </div>

                <div class="footer-right">

                    <div class="footer-nav">
                        <h3>Popular</h3>
                        <ul>
                            <li><a href="#">Programming</a></li>
                            <li><a href="#">Books for children</a></li>
                            <li><a href="#">Psychology</a></li>
                            <li><a href="#">Business</a></li>
                        </ul>
                    </div>

                    <div class="footer-nav">
                        <h3>Cash</h3>
                        <ul>
                            <li><a href="#">Delivery</a></li>
                            <li><a href="#">Payment</a></li>
                            <li><a href="#">About the store</a></li>
                        </ul>
                    </div>

                    <div class="footer-nav" style="margin-right: 0;">
                        <h3>Help</h3>
                        <ul>
                            <li><a href="#">Contacts</a></li>
                            <li><a href="#">Purchase returns</a></li>
                            <li><a href="#">Buyer help</a></li>
                        </ul>
                    </div>

                </div>

            </div>

            <div class="copyright">
                <p>All rights reserved © 2003-2021 LIBRARY TERMS OF USE | Privacy Policy</p>
            </div>

        </div>

    </footer>



    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script src="../js/slick.js"></script>
    <script src="../js/toast.script.js"></script>
    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, set, get, ref, push, child, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBIwPUrIeIwVhdFOO24FP37qBLiHeLIsRw",
            authDomain: "library-project-3c5d6.firebaseapp.com",
            databaseURL: "https://library-project-3c5d6-default-rtdb.firebaseio.com",
            projectId: "library-project-3c5d6",
            storageBucket: "library-project-3c5d6.appspot.com",
            messagingSenderId: "294284130679",
            appId: "1:294284130679:web:51ed25900557833811c972"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const bkNameInp = document.querySelector("#bkNameInp");
        const searchBtn = document.querySelector("#searchBtn");
        const cardContainer = document.querySelector("#cardContainer");
        const fullname = document.querySelector("#fullname");
        const email = document.querySelector("#email");
        const joinbtn = document.querySelector("#joinbtn");

        function showTrueBook() {

            let bkName = bkNameInp.value.toLowerCase();

            if (bkName) {
                get(ref(db, "book-data/"))
                    .then((snapshot) => {
                        cardContainer.innerHTML = ""
                        bkNameInp.value = "";
                        let bookData = snapshot.val();
                        let bookArr = Object.entries(bookData);
                        let completed = false;

                        bookArr.forEach((el, i) => {

                            if (el[1].bookName.toLowerCase().trim().includes(bkName) || el[1].authorName.toLowerCase().trim().includes(bkName)) {

                                cardContainer.innerHTML += `<div class="insideCard">
                              <div>
                               <img src="${el[1].bookImage}" style="width:220px; padding-right: 37px;">
                               </div>
                                    <div class="bookText">
                                        <h2>${el[1].bookName}</h2>
                                        <h3>${el[1].authorName}</h3>
                                        <p>
                                        ${el[1].description.length > 350 ? el[1].description.slice(0, 350) + "..." : el[1].description}
                                        </p>
                                    </div>
                                </div>`
                            }


                            if (i == bookArr.length - 1) {
                                completed = true
                            }

                            if (completed) {
                                $("#cardContainer").slick({
                                    prevArrow: `<div class="prev"><img src="../icons/leftBtn.svg" alt="left-btn"></div>`,
                                    nextArrow: `<div class="next"><img src="../icons/rightBtn.svg" alt="right-btn"></div>`,
                                });

                            }

                        })


                    })
            } else {
                $.Toast("Error", "Please, Enter Valid Value!", "error", {
                    position_class: 'toast-top-right',
                    timeout: 4000,
                    has_progress: true,
                    width: 300
                })
            }

        }

        function joinUs(e) {
            e.preventDefault();

            if (fullname.value && email.value && validateEmail(email.value)) {
                push(ref(db, "join-us-data/"), {
                    fullName: fullname.value,
                    emailAddress: email.value,
                })
                    .then(() => {
                        $.Toast(
                            "Successful",
                            "You Joined With Us Successfully",
                            "success",
                            {
                                position_class: "toast-top-right",
                                timeout: 4000,
                                has_progress: true,
                                width: 300,
                            }
                        );
                    })

                    .catch((error) => {
                        $.Toast("Warning", "Data Could not Send", "warning", {
                            position_class: "toast-top-right",
                            timeout: 4000,
                            has_progress: true,
                            width: 300,
                        });
                    });
            } else {
                $.Toast("Unsuccessful", "Please, Enter Valid Email and Username", "error", {
                    position_class: "toast-top-right",
                    timeout: 4000,
                    has_progress: true,
                    width: 300,
                });
            }
            fullname.value = "";
            email.value = "";
        }

        function validateEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }


        searchBtn.addEventListener("click", showTrueBook);
        joinbtn.addEventListener("click", joinUs);

    </script>
    <script src="../js/modal.js"></script>
    <script src="../js/hamburger.js"></script>
</body>

</html>